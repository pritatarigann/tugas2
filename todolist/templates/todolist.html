<html>
{% extends 'base.html' %}

{% block meta %}
<title>Todolist</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<head> 
    {% load static %}
    <link rel="stylesheet" href="{% static './todolist.css' %}">
</head>
{% endblock meta %}

{% block content %}
<body>
    <script>
        function getData(){
          $.get('/todolist/json/', function(data){
            showData(data);
          })
        };
      
        function showData(data){
          if (data.length == 0){
            let msg = `<div class="msg text-center">
                        <div class="header2_style">You have nothing on list</div>
                        </div>`;
            document.getElementById('task-cards').innerHTML = msg;
          } else{
            let card = '';
            for (let task of data){
              if (task.fields.is_finished){
                card += `
                  <div class="card-row">
                      <div class="card-column">
                          <div class="card">
                            <div class="title-status">
                                <p class="task-date"><small class="text-muted">${task.fields.date}</small></p>
                                <p class="task-title h4">${task.fields.title}</h4>
                            </div>
                        <p class="task-desc">${task.fields.description}</p>
                        <p class="badge bg-success">Finished</p>
                        <div class="task-button">
                            <a class="button1" href="update-status/${task.pk}" role="button">Change Status</a>
                            <a class="button2" onclick="deleteData(${task.pk})" role="button">Delete Task</a>
                        </div>
                  </div>
              </div>`;
              } else{
                card += `
                  <div class="card-row">
                      <div class="card-column">
                          <div class="card">
                            <div class="title-status">
                                <p class="task-date"><small class="text-muted">${task.fields.date}</small></p>
                                <p class="task-title">${task.fields.title}</h4>
                            </div>
                        <p class="task-desc">${task.fields.description}</p>
                        <p class="badge bg-secondary">On going</p>
                        <div class="task-button">
                            <a class="button1" href="update-status/${task.pk}" role="button">Change Status</a>
                            <a class="button2" onclick="deleteData(${task.pk})" role="button">Delete Task</a>
                        </div>
                  </div>
              </div>`;
              } 
            };
            document.getElementById('task-cards').innerHTML = card;
          };  
        };
      
        function clearFields(){
          $("#new-task")[0].reset();
        }
      
        function deleteData(id){
          $.ajax({
            type: 'DELETE',
            url: '/todolist/delete-task/' + id,
            dataType: 'json',
            headers: {
              "X-CSRFTOKEN": "{{ csrf_token }}"
            },
            success: function(data){
              console.log("Deleted!");
              getData();
            }
          })
        }
      
        $(document).ready(function(){
          getData();
          $("button").click(function (){
            getData();
          });
        });
      
        $(document).on('submit', '#new-task', function(e){
          e.preventDefault();
          $.ajax({
            type: 'POST',
            url: '/todolist/add/',
            data: {
              title: $('#taskname').val(),
              description: $('#taskdesc').val(),
              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
              action:'post',
            },
            dataType: 'json',
            success: function(data){
              console.log("Task is created successfully");
              getData();
              $('#add-new-task').modal('hide');
              $('.modal-backdrop').remove();
              clearFields()
            }
          })
        })
      </script>  

    <nav class="navbar navbar-expand-sm mb-3 p-2" style="background-color: #FFFF;">
        <div class="container-fluid" >
            <span class="navbar-brand m-2 h-1 fw-bold">{{username}}'s 𓍊𓋼𓍊𓋼𓍊</span>
                <ul class="navbar-nav ml-auto">
                    <li><button type="button" class="button3" data-bs-toggle="modal" data-bs-target="#add-new-task">Add Task</button></li>
                    <li><a class="button4" href="{% url 'todolist:logout' %}" role="button">Logout</a></li>
                </ul>
        </div>
    </nav>
    
    <div class="modal fade" id="add-new-task" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="header_style4" id="staticBackdropLabel">⚝ Add New Task ⚝</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="clearFields()"></button>
                </div>
                <div class="modal-body">
                    <form method="POST" action="" id="new-task">
                        {% csrf_token %}
                        <div class="m-3 p-1">
                            <label for="input" class="form-label h5">Title:</label>
                            <input type="text" name="taskname" class="form-control" id="taskname" placeholder="What's is it?" required>
                        </div>
                        <div class="m-3 p-1">
                            <label for="input" class="form-label h5">Description:</label>
                            <input type="text" name="taskdesc" class="form-control" id="taskdesc" placeholder="Decsribe it!" rows="5">
                        </div>
                        <div class="task-button">
                            <a><button type="button" class="button4" data-bs-dismiss="modal" onclick="clearFields()">Discard</button></a>
                            <a><button type="submit" class="button3">Save</button></a>
                    </div>
                    </form>
                    </div>
                </div>
            </div>
    </div>

    <h3 class="header_style5" style="color: #FFFF;">˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚˚*•̩̩͙✩•̩̩͙*˚＊·͙*̩̩͙˚̩̥̩̥*̩̩̥͙　✩　*̩̩̥͙˚̩̥̩̥*̩̩͙‧͙·̩̩̥͙＊*•̩̩͙✩•̩̩͙*˚</h3>
    <br><br><br><br>
    <h2 class="header2_style" style="color: #FFFF;">.。･:*:･(✿◕3◕)❤ Check out your daily tasks here ❤(✿◕3◕).。･:*:･</h2>
    <div class="container">
        <div class="card-body">
            <div id="task-cards"></div> </div> </div> 
            {% if messages %}
                {% for message in messages %}
                <div class="alert alert-primary alert-dismissible fade show mx-4" role="alert">
                    {{message}}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            {% endif %}
</body>
 {% endblock content %}
 </html>